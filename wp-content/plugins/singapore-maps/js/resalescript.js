/*  Created on : Jul 30, 2014, 2:35:09 PM  Author: Tran Trong Thang  Email: trantrongthang1207@gmai.com  */var resale_gmarkers = [];var resale_not_done = [];var resale_map;jQuery(document).ready(function($) {    $ = jQuery;    //code for adding style for mozilla    var browsers = Array();    $.each($.browser, function(i, val) {        browsers[i] = val;        if (i == 'mozilla') {        }    });    //code for adding browser specific classes    if (browsers['msie'] && browsers['version'] == '7.0') {        $("body").addClass('ie7');        $("body").addClass('ie');    }    if (browsers['msie'] && browsers['version'] == '8.0') {        $("body").addClass('ie8');        $("body").addClass('ie');    }    if (browsers['msie'] && browsers['version'] == '9.0') {        $("body").addClass('ie9');        $("body").addClass('ie');    }    if (browsers['mozilla']) {        $("body").addClass('moz');    }    if (browsers['webkit']) {        $("body").addClass('chrome');    }    if (browsers['opera']) {        $("body").addClass('opera');        //alert($(".container").width())    }    // Check for touch screens    if (Modernizr.touch) {        var showToolTip = false;    } else {        var showToolTip = true;    }    // Initialize Address plugin    jQuery.address.strict(false);    jQuery.address.externalChange(function(event) {        if (window.location.hash != '#rentalmap') {            if (window.location.hash != '#resalemap') {                var hash = window.location.hash;                if (hash.indexOf("resale_") > 0) {                    $(".v3-tabs-hds-wrapper .v3-tab-hd").removeClass("active");                    $(".v3-tabs-hds-wrapper .v3-tab-hd[data-target='resale-tb']").addClass("active");                    $(".v3-tabs-content-wrapper .v3-tab-content").removeClass("active");                    $(".v3-tabs-content-wrapper .v3-tab-resale-tb").addClass("active");                    jQuery('.singapore_maps_resale #regional_map').hide();                    jQuery('.singapore_maps_resale #maps_container').show();                    jQuery(hash).fadeIn();                    selectMap(hash.replace("#", ""));                    $(".singapore_maps_resale #sidebar-map-singapo").show();                    $(".singapore_maps_resale #filter_hackerspace[typeregion='" + hash.replace("#", "").replace("resale_", "") + "']").addClass("inactive");                }            } else if (window.location.hash == '#resalemap') {                $(".v3-tabs-hds-wrapper .v3-tab-hd").removeClass("active");                $(".v3-tabs-hds-wrapper .v3-tab-hd[data-target='resale-tb']").addClass("active");                $(".v3-tabs-content-wrapper .v3-tab-content").removeClass("active");                $(".v3-tabs-content-wrapper .v3-tab-resale-tb").addClass("active");                return;            }        }    });    // Initialize ImageMapster plugin    jQuery('.singapore_maps_resale #regional_map img').mapster({        fillColor: 'ffffff',        fillOpacity: 0.3,        mapKey: 'alt',        showToolTip: showToolTip,        onClick: function(event) {            // console.log('CLICKED');            jQuery('.singapore_maps_resale #regional_map').hide().removeClass('regional_map');            jQuery('.singapore_maps_resale #maps_container').show();            jQuery('.singapore_maps_resale #' + event.key).fadeIn();            selectMap(event.key);            jQuery.address.value(event.key);            jQuery(".singapore_maps_resale .fgcback").show();            jQuery(".singapore_maps_resale #sidebar-map-singapo").show();            $(".singapore_maps_resale .category_toggle").removeClass('inactive');            $(".singapore_maps_resale #filter_hackerspace[typeregion='" + event.key.replace("resale_", "") + "']").addClass("inactive");            $(".singapore_maps_resale #filter_hackerspace[typeregion='" + event.key.replace("resale_", "") + "']").parent().next().show();        },        areas: [            {key: 'north_map', isSelectable: false, toolTip: mapToolTips.north},            {key: 'northeast_map', isSelectable: false, toolTip: mapToolTips.northEast},            {key: 'east_map', isSelectable: false, toolTip: mapToolTips.east},            {key: 'west_map', isSelectable: false, toolTip: mapToolTips.west},            {key: 'central_map', isSelectable: false, toolTip: mapToolTips.central},        ]    });    /*          * Trong Thang(trantrongthang1207@gmail.com)          */    jQuery(".singapore_maps_resale .fgctooltip .map-label").live('click', function(e) {        e.preventDefault();        var eventkey = jQuery(this).attr("href");        jQuery('.singapore_maps_resale #regional_map').hide().removeClass('regional_map');        jQuery('.google_map').hide();        jQuery('.singapore_maps_resale #maps_container').show();        jQuery('.singapore_maps_resale #' + eventkey).fadeIn();        selectMap(eventkey);        jQuery.address.value(eventkey);        jQuery(".singapore_maps_resale .fgcback").show();        $(".singapore_maps_resale #sidebar-map-singapo").show();        $(".singapore_maps_resale .category_toggle").removeClass('inactive');        $(".singapore_maps_resale #filter_hackerspace[typeregion='" + eventkey.replace("resale_", "") + "']").addClass("inactive");        $(".singapore_maps_resale #filter_hackerspace[typeregion='" + eventkey.replace("resale_", "") + "']").parent().next().show();    })    jQuery(".singapore_maps_resale .fgcback").live('click', function(e) {        e.preventDefault();        jQuery(".singapore_maps_resale .fgcback").hide();        jQuery(".singapore_maps_resale #sidebar-map-singapo").hide();        jQuery('.google_map, .child-content').hide();        jQuery('.singapore_maps_resale #regional_map').show().addClass('regional_map');        jQuery('.singapore_maps_resale #maps_container').hide();        location.hash = 'resalemap';    })    /*          * Hien thi cac icon cua tung khu vuc          */    // toggle (hide/show) markers of a given type (on the map)    $(".singapore_maps_resale #filter_hackerspace").live('click', function() {        var type = $(this).attr('typeregion')        if ($(this).is('.inactive')) {            hide(type, $(this));        } else {            show(type, $(this));        }    })    jQuery(".singapore_maps_resale .category_info").live('click', function(e) {        e.preventDefault();        var type = $(this).attr('href')        if ($(this).prev().is('.inactive')) {            hide(type, $(this).prev());        } else {            show(type, $(this).prev());        }    })// hide all markers of a given type    function hide(type, me) {        for (var i = 0; i < resale_gmarkers.length; i++) {            if (resale_gmarkers[i].type == type) {                resale_gmarkers[i].setVisible(false);            }        }        me.removeClass("inactive");    }    // show all markers of a given type    function show(type, me) {        //console.log(gmarkers.length)        for (var i = 0; i < resale_gmarkers.length; i++) {            // console.log(gmarkers[i])            if (resale_gmarkers[i].type == type) {                resale_gmarkers[i].setVisible(true);            }        }        me.addClass("inactive");    }    /*          * Thay su kien click len cac icon tren map          */    $(".singapore_maps_resale .child-content li a").live('click', function(e) {        e.preventDefault();        var marker_id = $(this).attr('indexicon');        //console.log(marker_id, gmarkers)        if (marker_id) {            resale_map.panTo(resale_gmarkers[marker_id].getPosition());            resale_map.setZoom(15);            google.maps.event.trigger(resale_gmarkers[marker_id], 'click');            //google.maps.event.trigger(gmarkers[marker_id], 'click');        }    })    if (mapScaledHeightimg != '' && mapScaledWidthimg != '') {        jQuery('.singapore_maps_resale #regional_map img').mapster('resize', mapScaledWidthimg, mapScaledHeightimg, 0);    }    // Select Google map    function selectMap(key) {        //var lat = 1.364236;        //var long = 103.836937;        var lat = 1.365342;        var long = 103.807411;        switch (key) {            case 'resale_north_map':                mapIcon = '';                mapIcon = mapIconNorth;                initGoogleMap(key, 'resale_north_map', lat, long);                break;            case 'resale_northeast_map':                mapIcon = '';                mapIcon = mapIconNorthEast;                initGoogleMap(key, 'resale_northeast_map', lat, long);                break;            case 'resale_east_map':                mapIcon = '';                mapIcon = mapIconEast;                initGoogleMap(key, 'resale_east_map', lat, long);                break;            case 'resale_west_map':                mapIcon = '';                mapIcon = mapIconWest;                initGoogleMap(key, 'resale_west_map', lat, long);                break;            case 'resale_central_map':                mapIcon = '';                mapIcon = mapIconCentral;                initGoogleMap(key, 'resale_central_map', lat, long);                break;        }    }    // Initialize Google map    function initGoogleMap(elementID, region, latitude, longitude) {        var mapOptions = {            zoom: 12, //Giam zoom de hien thi het map cua singapore            center: new google.maps.LatLng(latitude, longitude),            mapTypeId: google.maps.MapTypeId.ROADMAP,        };        resale_map = new google.maps.Map(document.getElementById(elementID), mapOptions);        var listings = JSON.parse(resalemapListings);        console.log(listings)        createMapMarkers(resale_map, listings, region);    }    // Add markers to Google map    function createMapMarkers(map, listings, region) {        // jQuery('#maps_container').show();        $('html, body').animate({            scrollTop: jQuery('.v3-grid-listings').offset().top + 'px'        }, 700);        $(".child-content").html('');        //console.log('listings', listings.length, listings);        gmarkers = [];        if (listings) {            var geocoder = new google.maps.Geocoder();            var infoBox = new InfoBox({                closeBoxURL: mapCloseIcon,                alignBottom: true,                nplayout: true            });            var jj = 0;            for (var i = 0; i < listings.length; i++) {                var title = listings[i].title;                var address = listings[i].address;                var link = listings[i].link;                var thumbURL = listings[i].thumbURL;                var description = listings[i].description;                var typeRegion = listings[i].type;                var iconmarker = listings[i].icon;                var price = listings[i].price;                (function(title, link, thumbURL, description, typeRegion, iconmarker, price) {                    /* geocoder.geocode({'address': address}, function(results, status) { */                    //listings[i].lat = 1.350827 + (i * 0.001);                    //listings[i].lng = 103.669254 + (i * 0.01);                    if (listings[i].lat && listings[i].lng) {                        // Add marker and bind click event                        var marker = new google.maps.Marker({                            position: new google.maps.LatLng(parseFloat(listings[i].lat), parseFloat(listings[i].lng)),                            map: map,                            title: title                        });                        /*                                                  * Day gia tri cua map vao mot mang va duoc danh dau                                                   */                        marker.type = typeRegion;                        resale_gmarkers.push(marker);                        /*                                                  * Khong hien thi cac icon cua khu vuoc khong duoc chon                                                  */                        //console.log(typeRegion, region)                        if (typeRegion != region.replace("resale_", ""))                            marker.setVisible(false);                        //console.log('test', i, title)                        if (iconmarker != '') {                            marker.setIcon(iconmarker);                        }                        // Bind marker to click event                        if (mapDetails) {                            google.maps.event.addListener(marker, 'click', function() {                                if (infoBox)                                    infoBox.close();                                var content = "<div class='google_details'><div class='google_sidebar'>";                                content += "<a href='" + link + "' title='" + title + "'>";                                if (thumbURL) {                                    content += "<img class='google_thumbnail' src='" + thumbURL + "' alt='' />";                                } else {                                    content += "<img class='google_thumbnail' src='" + mapNoPhoto + "' alt='' />";                                }                                content += "</a>";                                if (price) {                                    content += "<div class='np_price'><sup class='currency'>$</sup><span class='price_amount'>" + price + "</span><sup class='currency'></sup><span class='np_icon'><i class='icon-bolt'>&nbsp;</i></span></div>";                                }                                content += "</div>";                                content += "<div class='np_bottom'>";                                content += "<a class='title' href='" + link + "' title=''>" + title + "</a>";                                if (description) {                                    content += "<div class='np_des'>" + description + "</div>";                                }                                content += "</div>";                                infoBox.setContent("<div class='google_infobox'>" + content + "</div>");                                infoBox.setPosition(marker.getPosition());                                infoBox.open(map, marker);                            });                            google.maps.event.addListener(resale_map, 'click', function() {                                infoBox.close();                            })                        }                        /*                                                  * Khong thuc hien chem dia chi vao menu trai                                                  */                        //$(".child-content." + typeRegion).append('<li><a indexicon="' + jj + '" href="">' + title + '</a></li>')                        //jj++;                        //console.log('mapped' + i);                    } else {                        /*the address could not be mapped*/                        resale_not_done[i] = [i];                        resale_not_done[i]['typeRegion'] = typeRegion;                        resale_not_done[i]['index'] = i;                        resale_not_done[i]['status'] = false;                    }                    /*  }); */                })(title, link, thumbURL, description, typeRegion, iconmarker, price);            }            console.log(resale_not_done);        }    }    //sidebar    jQuery(".singapore_maps_resale #sidebar-map-singapo ul.list .category a.category_info").click(function() {        $accordion = jQuery(this).parent().parent().find('.child-content');        if ($accordion.is(':hidden') === true) {            // jQuery('.category_toggle').removeClass('inactive');            jQuery(".singapore_maps_resale #sidebar-map-singapo ul.list .category .child-content").slideUp();            $accordion.slideDown();            // jQuery(this).find('.category_toggle').addClass('inactive');        }    });});